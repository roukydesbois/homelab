apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - immich-db-sc.yaml
  - library-pvc.yaml
  - postgis-cluster.yaml
  - ../../base
  - immich-ingress.yaml

patchesStrategicMerge:
  - |-
    apiVersion: argoproj.io/v1alpha1
    kind: Application
    metadata:
      name: immich-helm-chart
      namespace: immich
    spec:
      source:
        helm:
          valuesObject:
            image:
              tag: 1.131.2
            persistence:
              library:
                existingClaim: immich-library
  - |-
    apiVersion: networking.k8s.io/v1
    kind: Ingress
    metadata:
      name: ts-immich
      namespace: immich
      annotations:
        tailscale.com/funnel: "true"
    spec:
      tls:
        - hosts:
            - photos-temp
