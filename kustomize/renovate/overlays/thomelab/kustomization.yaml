apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization
resources:
  - renovate-sealed-secret.yaml
  - ../../base

patches:
  - patch: |-
      - op: add
        path: /spec/source/helm/valuesObject/renovate/mendRnvPlatform
        value: "github"
      - op: add
        path: /spec/source/helm/valuesObject/renovate/mendRnvEndpoint
        value: "https://api.github.com/"
      - op: add
        path: /spec/source/helm/valuesObject/renovate/mendRnvGithubAppId
        valueFrom:
          secretKeyRef:
            name: renovate-secret
            key: github-app-id
      - op: add
        path: /spec/source/helm/valuesObject/renovate/mendRnvGithubBotUserId
        valueFrom:
          secretKeyRef:
            name: renovate-secret
            key: github-bot-user-id
      - op: add
        path: /spec/source/helm/valuesObject/renovate/mendRnvGithubAppKey
        valueFrom:
          secretKeyRef:
            name: renovate-secret
            key: github-app-private-key
      - op: add
        path: /spec/source/helm/valuesObject/renovate/mendRnvLicenseKey
        valueFrom:
          secretKeyRef:
            name: renovate-secret
            key: mend-licence-key
    target:
      group: argoproj.io
      version: v1alpha1
      kind: Application
      name: renovate-helm-chart
      namespace: renovate
