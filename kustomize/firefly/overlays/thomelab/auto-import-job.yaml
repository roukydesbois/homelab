apiVersion: batch/v1
kind: CronJob
metadata:
  name: auto-import-job
  namespace: firefly
spec:
  schedule: "0 18 * * *"
  jobTemplate:
    spec:
      template:
        spec:
          restartPolicy: Never
          containers:
            - name: data-importer-cli
              image: fireflyiii/data-importer:latest-cli@sha256:93b80762fee06fc2110fbb7b8c2cecb1c4542c7f2bbb4172fd046a3bbfc8bafd
              command: ["php", "artisan", "importer:import", "/import/import-config.json"]
              envFrom:
                - secretRef:
                    name: firefly-config
              env:
                - name: FIREFLY_III_URL
                  value: http://firefly-iii-chart:80
                - name: WEB_SERVER
                  value: "false"
                - name: IGNORE_DUPLICATE_ERRORS
                  value: "true"
              volumeMounts:
                - name: bank-imports
                  mountPath: /import
          volumes:
            - name: bank-imports
              secret:
                secretName: bank-imports
                items:
                  - key: import-config.json
                    path: import-config.json
